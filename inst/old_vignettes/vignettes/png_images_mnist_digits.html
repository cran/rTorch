<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>png_images_mnist_digits</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">png_images_mnist_digits</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(rTorch)</a></code></pre></div>
<div id="digits-recognition-on-png-images.-r-code" class="section level1">
<h1>Digits recognition on PNG images. R code</h1>
<ol style="list-style-type: decimal">
<li>Added utility functions</li>
<li>Introspection on dim=2. Extra layers on tensor</li>
<li>Converting code from Python to R</li>
<li>Read PNG images instead of the MNIST standard dataset (IDX format)</li>
</ol>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<ol style="list-style-type: decimal">
<li>Read PNG images instead of MNIST standard dataset.</li>
<li>Save the model</li>
<li>Read an unseen digit using the model</li>
<li>Predict digit and calculate accuracy</li>
</ol>
</div>
<div id="load-pytorch-libraries" class="section level2">
<h2>Load PyTorch libraries</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">nn          &lt;-<span class="st"> </span>torch<span class="op">$</span>nn</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">transforms  &lt;-<span class="st"> </span>torchvision<span class="op">$</span>transforms</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">dsets       &lt;-<span class="st"> </span>torchvision<span class="op">$</span>datasets</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">builtins    &lt;-<span class="st"> </span><span class="kw">import_builtins</span>()</a></code></pre></div>
</div>
<div id="dataset-iteration-batch-settings" class="section level2">
<h2>Dataset iteration batch settings</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># batch size for datasets</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">batch_size_train =<span class="st"> </span>100L</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">batch_size_test  =<span class="st"> </span>1000L</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># folders where te images are located</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">train_data_path =<span class="st"> '~/mnist_png_full/training/'</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">test_data_path  =<span class="st"> '~/mnist_png_full/testing/'</span></a></code></pre></div>
</div>
<div id="read-datasets" class="section level2">
<h2>Read datasets</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># read the datasets without normalization</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">train_dataset =<span class="st"> </span>torchvision<span class="op">$</span>datasets<span class="op">$</span><span class="kw">ImageFolder</span>(<span class="dt">root =</span> train_data_path, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="dt">transform =</span> torchvision<span class="op">$</span>transforms<span class="op">$</span><span class="kw">ToTensor</span>()</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">test_dataset =<span class="st"> </span>torchvision<span class="op">$</span>datasets<span class="op">$</span><span class="kw">ImageFolder</span>(<span class="dt">root =</span> test_data_path, </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="dt">transform =</span> torchvision<span class="op">$</span>transforms<span class="op">$</span><span class="kw">ToTensor</span>()</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="kw">cat</span>(<span class="kw">py_len</span>(train_dataset), <span class="kw">py_len</span>(test_dataset), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 60000 10000</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">train_dataset<span class="op">$</span><span class="st">`</span><span class="dt">__len__</span><span class="st">`</span>()</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; [1] 60000</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="kw">class</span>(train_dataset)        <span class="co"># &lt;class 'torchvision.datasets.folder.ImageFolder'&gt;</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; [1] &quot;torchvision.datasets.folder.ImageFolder&quot;  </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; [2] &quot;torchvision.datasets.folder.DatasetFolder&quot;</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; [3] &quot;torchvision.datasets.vision.VisionDataset&quot;</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; [4] &quot;torch.utils.data.dataset.Dataset&quot;         </span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; [5] &quot;python.builtin.object&quot;</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co"># in Python train_dataset[0] is a tuple</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co"># In R, this will produce an error</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co"># expect_error(class(train_dataset[0]))      # &lt;class 'tuple'&gt;</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"></a>
<a class="sourceLine" id="cb4-26" data-line-number="26">train_dataset</a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; Dataset ImageFolder</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt;     Number of datapoints: 60000</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt;     Root location: /home/msfz751/mnist_png_full/training/</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co"># Dataset ImageFolder</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#     Number of datapoints: 60000</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#     Root location: /home/msfz751/mnist_png_full/training/</span></a></code></pre></div>
</div>
<div id="read-image-and-label-for-a-data-point" class="section level2">
<h2>Read image and label for a data point</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># retrieve a random data point from the dataset</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">random &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;random&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">i_rand =<span class="st"> </span>random<span class="op">$</span><span class="kw">randrange</span>(<span class="dv">0</span>, <span class="kw">py_len</span>(train_dataset)<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">i_rand</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; [1] 53405</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># the Python object is a tuple with two elements</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># But in R returns as a list of two elements</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">dataset_object =<span class="st"> </span><span class="kw">py_get_item</span>(train_dataset, i_rand)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">dataset_object</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; tensor([[[0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;          ...,</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.]],</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;         [[0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt;          ...,</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.]],</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt;         [[0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="co">#&gt;          ...,</span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-33" data-line-number="33"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.],</span></a>
<a class="sourceLine" id="cb5-34" data-line-number="34"><span class="co">#&gt;          [0., 0., 0.,  ..., 0., 0., 0.]]])</span></a>
<a class="sourceLine" id="cb5-35" data-line-number="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb5-37" data-line-number="37"><span class="co">#&gt; [1] 8</span></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"></a>
<a class="sourceLine" id="cb5-39" data-line-number="39"><span class="kw">class</span>(dataset_object)</a>
<a class="sourceLine" id="cb5-40" data-line-number="40"><span class="co">#&gt; [1] &quot;list&quot;</span></a>
<a class="sourceLine" id="cb5-41" data-line-number="41"><span class="kw">length</span>(dataset_object)</a>
<a class="sourceLine" id="cb5-42" data-line-number="42"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb5-43" data-line-number="43"></a>
<a class="sourceLine" id="cb5-44" data-line-number="44">image &lt;-<span class="st"> </span>dataset_object[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb5-45" data-line-number="45">label &lt;-<span class="st"> </span>dataset_object[[<span class="dv">2</span>]]</a></code></pre></div>
<p>The size of the image tensor is <code>torch.Size([3, 28, 28])</code> but it should really be <code>torch.Size([1, 28, 28])</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">image<span class="op">$</span><span class="kw">size</span>()  <span class="co"># torch.Size([3, 28, 28])</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; torch.Size([3, 28, 28])</span></a></code></pre></div>
<div id="introspection-of-train_dataset" class="section level3">
<h3>Introspection of train_dataset</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">builtins<span class="op">$</span><span class="kw">type</span>(<span class="kw">py_get_item</span>(train_dataset, 0L))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; &lt;class 'list'&gt;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">print</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">first member of the tuple is a tensor for the image&quot;</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [1] &quot;\tfirst member of the tuple is a tensor for the image&quot;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">builtins<span class="op">$</span><span class="kw">type</span>(<span class="kw">py_get_item</span>(train_dataset, 0L)[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; &lt;class 'torch.Tensor'&gt;</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">print</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">second member of the tuple is an integer for the label&quot;</span>)</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; [1] &quot;\tsecond member of the tuple is an integer for the label&quot;</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">builtins<span class="op">$</span><span class="kw">type</span>(<span class="kw">py_get_item</span>(train_dataset, 0L)[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; &lt;class 'int'&gt;</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># check size of first and last data point tensor, image part</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">py_get_item</span>(train_dataset, 0L)[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">size</span>()      <span class="co"># first object</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; torch.Size([3, 28, 28])</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">py_get_item</span>(train_dataset, 59999L)[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">size</span>()  <span class="co"># last object</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; torch.Size([3, 28, 28])</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">image<span class="op">$</span><span class="kw">size</span>()</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; torch.Size([3, 28, 28])</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co"># it is torch.Size([3, 28, 28]) but it should be 1, 28, 28</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co"># we will take only one slice of dim=1</span></a></code></pre></div>
</div>
<div id="size-of-tensor-on-dim2" class="section level3">
<h3>Size of tensor on dim=2</h3>
<p>The tensors on dim=2 seem to be identical. We will confirm in the following chunk:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># dim=2 has three layers. choose only one</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># but find out if all of them are the same</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">image[<span class="dv">0</span>, :, :].size()   <span class="co"># take only one slice in dim=2</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">image[<span class="dv">1</span>, :, :].size()   <span class="co"># take only one slice in dim=2</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">image[<span class="dv">2</span>, :, :].size()   <span class="co"># take only one slice in dim=2</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"># same value for sums of the tensors means that all tensors are virtually the same</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">image[<span class="dv">0</span>, :, :].<span class="bu">sum</span>()   <span class="co"># take only one slice in dim=2</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">image[<span class="dv">1</span>, :, :].<span class="bu">sum</span>()   <span class="co"># take only one slice in dim=2</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">image[<span class="dv">2</span>, :, :].<span class="bu">sum</span>()   <span class="co"># take only one slice in dim=2</span></a></code></pre></div>
</div>
<div id="take-one-slice-of-dim2" class="section level3">
<h3>Take one slice of dim=2</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># select one layer of the tensor. 28x28 is the grid space</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co"># take a slice 0:1 but could have been 1:2 or 2:3</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">image[<span class="dv">0</span>:<span class="dv">1</span>, :, :].size()</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">image[<span class="dv">0</span>:<span class="dv">1</span>, :, :].numpy().shape</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">image[<span class="dv">1</span>, , ]<span class="op">$</span><span class="kw">size</span>()</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; torch.Size([28, 28])</span></a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">rotate &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">t</span>(<span class="kw">apply</span>(x, <span class="dv">2</span>, rev))   <span class="co"># function to rotate the matrix</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># the label for the corresponding tensor</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">print</span>(label)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; [1] 8</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># convert to numpy array and reshape</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">img_np_rs =<span class="st"> </span>np<span class="op">$</span><span class="kw">reshape</span>(image[<span class="dv">1</span>,,]<span class="op">$</span><span class="kw">numpy</span>(), <span class="kw">c</span>(28L, 28L))</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw">image</span>(<span class="kw">rotate</span>(img_np_rs))</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="retrieve-a-second-data-point" class="section level3">
<h3>Retrieve a second data point</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># second random data point</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">i_rand =<span class="st"> </span>random<span class="op">$</span><span class="kw">randrange</span>(<span class="dv">0</span>, <span class="kw">py_len</span>(train_dataset)<span class="op">-</span><span class="dv">1</span>)   <span class="co"># get a random data point</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">dataset_object =<span class="st"> </span><span class="kw">py_get_item</span>(train_dataset, i_rand)    <span class="co"># read the tuple</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">image &lt;-<span class="st"> </span>dataset_object[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">label &lt;-<span class="st"> </span>dataset_object[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co"># the label for the corresponding tensor</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="kw">print</span>(label)</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; [1] 9</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co"># convert to numpy array and reshape</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">img_np_rs =<span class="st"> </span>np<span class="op">$</span><span class="kw">reshape</span>(image[<span class="dv">1</span>,,]<span class="op">$</span><span class="kw">numpy</span>(), <span class="kw">c</span>(28L, 28L))</a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="kw">image</span>(<span class="kw">rotate</span>(img_np_rs))</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="reduce-the-number-of-layers-for-dim1-in-the-image" class="section level2">
<h2>Reduce the number of layers for dim=1 in the image</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># this class to be used to get rid of two duplicate layers in the image</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">main &lt;-<span class="st"> </span><span class="kw">py_run_string</span>(<span class="st">'</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">class PickLayerTransform:</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">    def __init__(self, layer):</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="st">        # self.img_ds = img</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">        self.layer = layer</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="st">        if self.layer &lt; 0: raise RuntimeError(&quot;Layer index {} cannot be negative &quot;.format(self.layer))</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="st">        </span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="st">    def __call__(self, img):</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="st">        if (self.layer &gt; len(img)-1): raise RuntimeError(&quot;Layer index {} incompatible with dimension size {}&quot;.format(self.layer, len(img)))</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="st">        return img[(self.layer-1):self.layer, :, :]</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="st">'</span>)</a>
<a class="sourceLine" id="cb14-13" data-line-number="13"></a>
<a class="sourceLine" id="cb14-14" data-line-number="14">PickLayerTransform &lt;-<span class="st"> </span>main<span class="op">$</span>PickLayerTransform</a>
<a class="sourceLine" id="cb14-15" data-line-number="15"></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co"># trying to resize tensor to [1, 28, 28]</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17">train_dataset =<span class="st"> </span>torchvision<span class="op">$</span>datasets<span class="op">$</span><span class="kw">ImageFolder</span>(<span class="dt">root =</span> train_data_path,</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">    <span class="dt">transform =</span> torchvision<span class="op">$</span>transforms<span class="op">$</span><span class="kw">Compose</span>(<span class="kw">c</span>(</a>
<a class="sourceLine" id="cb14-19" data-line-number="19">              transforms<span class="op">$</span><span class="kw">ToTensor</span>(),</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">              <span class="kw">PickLayerTransform</span>(1L)</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">    )))</a>
<a class="sourceLine" id="cb14-22" data-line-number="22"></a>
<a class="sourceLine" id="cb14-23" data-line-number="23">test_dataset =<span class="st"> </span>torchvision<span class="op">$</span>datasets<span class="op">$</span><span class="kw">ImageFolder</span>(<span class="dt">root =</span> test_data_path,</a>
<a class="sourceLine" id="cb14-24" data-line-number="24">    <span class="dt">transform =</span> torchvision<span class="op">$</span>transforms<span class="op">$</span><span class="kw">Compose</span>(<span class="kw">c</span>(</a>
<a class="sourceLine" id="cb14-25" data-line-number="25">              transforms<span class="op">$</span><span class="kw">ToTensor</span>(),</a>
<a class="sourceLine" id="cb14-26" data-line-number="26">              <span class="kw">PickLayerTransform</span>(1L)</a>
<a class="sourceLine" id="cb14-27" data-line-number="27">    )))</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># check size of a data point tensor, image part</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co"># train_dataset[0][0].size()       # first object</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co"># train_dataset[59999][0].size()   # last object</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="kw">py_get_item</span>(train_dataset, 0L)[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">size</span>()</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; torch.Size([1, 28, 28])</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="kw">py_get_item</span>(train_dataset, 59999L)[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">size</span>()</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; torch.Size([1, 28, 28])</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co"># this image generated before eliminating 2 extra layers</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="kw">print</span>(<span class="st">&quot;previous image size&quot;</span>)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; [1] &quot;previous image size&quot;</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">image<span class="op">$</span><span class="kw">size</span>()</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; torch.Size([3, 28, 28])</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co"># it is torch.Size([3, 28, 28]) but it should be 1, 28, 28</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co"># we will take only one slice of dim=1</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co"># the other two layers are the same</span></a></code></pre></div>
<div id="show-a-random-image" class="section level3">
<h3>Show a random image</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">i_rand =<span class="st"> </span>random<span class="op">$</span><span class="kw">randrange</span>(<span class="dv">0</span>, <span class="kw">py_len</span>(train_dataset)<span class="op">-</span><span class="dv">1</span>)   <span class="co"># get a random data point</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">dataset_object &lt;-<span class="st"> </span><span class="kw">py_get_item</span>(train_dataset, i_rand)    <span class="co"># read the tuple</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">image &lt;-<span class="st"> </span>dataset_object[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">label &lt;-<span class="st"> </span>dataset_object[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"></a>
<a class="sourceLine" id="cb16-8" data-line-number="8">image<span class="op">$</span><span class="kw">size</span>()</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; torch.Size([1, 28, 28])</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="kw">class</span>(label)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; [1] &quot;integer&quot;</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co"># the label for the corresponding tensor</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="kw">print</span>(label)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co"># convert to numpy array and reshape</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co"># we don't need to specify the layer index anymore</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co"># we can use this form:</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20">  <span class="co"># img_np_rs = img[:, :, :].numpy().reshape(28, 28) in Python</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21">  <span class="co"># or this:</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22">img_np_rs =<span class="st"> </span>np<span class="op">$</span><span class="kw">reshape</span>(image<span class="op">$</span><span class="kw">numpy</span>(), <span class="kw">c</span>(28L, 28L))</a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="kw">image</span>(<span class="kw">rotate</span>(img_np_rs))</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="apply-data-loader-and-batch-size" class="section level3">
<h3>Apply data loader and batch size</h3>
<p>To prevent losing features by using a simple for loop to iterate over the data. In particular, we are missing out on:</p>
<pre><code>Batching the data
Shuffling the data
Load the data in parallel using multiprocessing workers.</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># load the dataset of images</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">train_loader =<span class="st"> </span>torch<span class="op">$</span>utils<span class="op">$</span>data<span class="op">$</span><span class="kw">DataLoader</span>(</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">        train_dataset,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">        <span class="dt">batch_size=</span>batch_size_train,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">        <span class="dt">shuffle=</span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co"># load the dataset of images</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9">test_loader =<span class="st"> </span>torch<span class="op">$</span>utils<span class="op">$</span>data<span class="op">$</span><span class="kw">DataLoader</span>(</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">        test_dataset,</a>
<a class="sourceLine" id="cb18-11" data-line-number="11">        <span class="dt">batch_size=</span>batch_size_test,</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">        <span class="dt">shuffle=</span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13">    )</a>
<a class="sourceLine" id="cb18-14" data-line-number="14"></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw">cat</span>(<span class="kw">py_len</span>(train_loader), <span class="kw">py_len</span>(test_loader))</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; 600 10</span></a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Confirm that the dataset loaders are iterable objects</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">collections &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;collections&quot;</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">builtins<span class="op">$</span><span class="kw">isinstance</span>(train_loader, collections<span class="op">$</span>Iterable)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">builtins<span class="op">$</span><span class="kw">isinstance</span>(test_loader, collections<span class="op">$</span>Iterable)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
</div>
<div id="build-the-model" class="section level2">
<h2>Build the model</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Build the model</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co"># Same as linear regression! </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">main &lt;-<span class="st"> </span><span class="kw">py_run_string</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">import torch.nn as nn</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">class LogisticRegressionModel(nn.Module):</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="st">    def __init__(self, input_dim, output_dim):</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="st">        super(LogisticRegressionModel, self).__init__()</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="st">        self.linear = nn.Linear(input_dim, output_dim)</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="st">    def forward(self, x):</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="st">        out = self.linear(x)</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="st">        return out</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb20-15" data-line-number="15"></a>
<a class="sourceLine" id="cb20-16" data-line-number="16">LogisticRegressionModel &lt;-<span class="st"> </span>main<span class="op">$</span>LogisticRegressionModel</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># feeding the model with 28x28 images</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">input_dim =<span class="st"> </span>28L<span class="op">*</span>28L</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co"># classify digits 0-9 a total of 10 classes,</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5">output_dim =<span class="st"> </span>10L</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co"># instantiate model</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8">model =<span class="st"> </span><span class="kw">LogisticRegressionModel</span>(input_dim, output_dim)</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">model</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; LogisticRegressionModel(</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt;   (linear): Linear(in_features=784, out_features=10, bias=True)</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt; )</span></a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">### Instantiate Cross Entropy Loss class</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co"># need Cross Entropy Loss to calculate loss before we backpropagation</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">criterion =<span class="st"> </span>nn<span class="op">$</span><span class="kw">CrossEntropyLoss</span>()  </a>
<a class="sourceLine" id="cb22-4" data-line-number="4"></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co"># calculate parameters' gradients and update</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6">learning_rate =<span class="st"> </span><span class="fl">0.001</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">### Instantiate Optimizer class</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9">optimizer =<span class="st"> </span>torch<span class="op">$</span>optim<span class="op">$</span><span class="kw">SGD</span>(model<span class="op">$</span><span class="kw">parameters</span>(), <span class="dt">lr=</span>learning_rate)  </a>
<a class="sourceLine" id="cb22-10" data-line-number="10">optimizer</a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; SGD (</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt; Parameter Group 0</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt;     dampening: 0</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt;     lr: 0.001</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"><span class="co">#&gt;     momentum: 0</span></a>
<a class="sourceLine" id="cb22-16" data-line-number="16"><span class="co">#&gt;     nesterov: False</span></a>
<a class="sourceLine" id="cb22-17" data-line-number="17"><span class="co">#&gt;     weight_decay: 0</span></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co">#&gt; )</span></a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Type of parameter object</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">print</span>(model<span class="op">$</span><span class="kw">parameters</span>())</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">#&gt; &lt;generator object Module.parameters at 0x7f82b2c577c8&gt;</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4">model_parameters &lt;-<span class="st"> </span>builtins<span class="op">$</span><span class="kw">list</span>(model<span class="op">$</span><span class="kw">parameters</span>())</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co"># Length of parameters</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="kw">print</span>(builtins<span class="op">$</span><span class="kw">len</span>(model_parameters))</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co"># FC 1 Parameters </span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="kw">print</span>(builtins<span class="op">$</span><span class="kw">list</span>(model_parameters)[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">size</span>())</a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="co">#&gt; torch.Size([10, 784])</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"></a>
<a class="sourceLine" id="cb23-14" data-line-number="14"><span class="co"># FC 1 Bias Parameters</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"><span class="kw">print</span>(builtins<span class="op">$</span><span class="kw">list</span>(model_parameters)[[<span class="dv">2</span>]]<span class="op">$</span><span class="kw">size</span>())</a>
<a class="sourceLine" id="cb23-16" data-line-number="16"><span class="co">#&gt; torch.Size([10])</span></a></code></pre></div>
<p>We arbitrarily set 3000 iterations here which means the model would update 3000 times.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">n_iters =<span class="st"> </span>3000L</a></code></pre></div>
<p>One epoch consists of 60,000 / 100 = 600 iterations. Because we would like to go through 3000 iterations, this implies we would have 3000 / 600 = 5 epochs as each epoch has 600 iterations.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">num_epochs =<span class="st"> </span>n_iters <span class="op">/</span><span class="st"> </span>(<span class="kw">py_len</span>(train_dataset) <span class="op">/</span><span class="st"> </span>batch_size_train)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">num_epochs =<span class="st"> </span><span class="kw">as.integer</span>(num_epochs)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">num_epochs</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co">#&gt; [1] 5</span></a></code></pre></div>
</div>
<div id="training-the-model" class="section level2">
<h2>Training the model</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># train the model</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">iter &lt;-<span class="st"> </span>0L</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="cf">for</span> (epoch <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>num_epochs) {</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">    iter_train_dataset &lt;-<span class="st"> </span>builtins<span class="op">$</span><span class="kw">enumerate</span>(train_loader) <span class="co"># reset iterator</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">    <span class="cf">for</span> (train_obj <span class="cf">in</span> <span class="kw">iterate</span>(iter_train_dataset)) {</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">        <span class="co"># extract images, labels</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7">        images &lt;-<span class="st"> </span>train_obj[[<span class="dv">2</span>]][[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">        labels &lt;-<span class="st"> </span>train_obj[[<span class="dv">2</span>]][[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb26-9" data-line-number="9">        <span class="co"># Load images as Variable</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10">        images =<span class="st"> </span>images<span class="op">$</span><span class="kw">view</span>(<span class="op">-</span>1L, 28L<span class="op">*</span>28L)<span class="op">$</span><span class="kw">requires_grad_</span>()</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">        labels =<span class="st"> </span>labels</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">        <span class="co"># Clear gradients w.r.t. parameters</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13">        optimizer<span class="op">$</span><span class="kw">zero_grad</span>()</a>
<a class="sourceLine" id="cb26-14" data-line-number="14">        <span class="co"># Forward pass to get output/logits</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15">        <span class="co"># outputs = model(torch$as_tensor(images, dtype = torch$double))</span></a>
<a class="sourceLine" id="cb26-16" data-line-number="16">        outputs =<span class="st"> </span><span class="kw">model</span>(images)</a>
<a class="sourceLine" id="cb26-17" data-line-number="17">        <span class="co"># Calculate Loss: softmax --&gt; cross entropy loss</span></a>
<a class="sourceLine" id="cb26-18" data-line-number="18">        loss =<span class="st"> </span><span class="kw">criterion</span>(outputs, labels)</a>
<a class="sourceLine" id="cb26-19" data-line-number="19">        <span class="co"># Getting gradients w.r.t. parameters</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20">        loss<span class="op">$</span><span class="kw">backward</span>()</a>
<a class="sourceLine" id="cb26-21" data-line-number="21">        <span class="co"># Updating parameters</span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22">        optimizer<span class="op">$</span><span class="kw">step</span>()</a>
<a class="sourceLine" id="cb26-23" data-line-number="23">        iter =<span class="st"> </span>iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24">        <span class="cf">if</span> (iter <span class="op">%%</span><span class="st"> </span><span class="dv">500</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb26-25" data-line-number="25">            <span class="co"># Calculate Accuracy for each epoch</span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26">            correct &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb26-27" data-line-number="27">            total &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb26-28" data-line-number="28">            <span class="co"># Iterate through test dataset</span></a>
<a class="sourceLine" id="cb26-29" data-line-number="29">            iter_test_dataset &lt;-<span class="st"> </span>builtins<span class="op">$</span><span class="kw">enumerate</span>(test_loader) <span class="co"># reset iterator</span></a>
<a class="sourceLine" id="cb26-30" data-line-number="30">            <span class="cf">for</span> (test_obj <span class="cf">in</span> <span class="kw">iterate</span>(iter_test_dataset)) {</a>
<a class="sourceLine" id="cb26-31" data-line-number="31">                <span class="co"># Load images to a Torch Variable</span></a>
<a class="sourceLine" id="cb26-32" data-line-number="32">                images &lt;-<span class="st"> </span>test_obj[[<span class="dv">2</span>]][[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb26-33" data-line-number="33">                labels &lt;-<span class="st"> </span>test_obj[[<span class="dv">2</span>]][[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb26-34" data-line-number="34">                images &lt;-<span class="st"> </span>images<span class="op">$</span><span class="kw">view</span>(<span class="op">-</span>1L, 28L<span class="op">*</span>28L)<span class="op">$</span><span class="kw">requires_grad_</span>()</a>
<a class="sourceLine" id="cb26-35" data-line-number="35">                <span class="co"># Forward pass only to get logits/output</span></a>
<a class="sourceLine" id="cb26-36" data-line-number="36">                <span class="co"># outputs = model(torch$as_tensor(images, dtype = torch$double))</span></a>
<a class="sourceLine" id="cb26-37" data-line-number="37">                outputs =<span class="st"> </span><span class="kw">model</span>(images)</a>
<a class="sourceLine" id="cb26-38" data-line-number="38">                <span class="co"># Get predictions from the maximum value</span></a>
<a class="sourceLine" id="cb26-39" data-line-number="39">                .predicted =<span class="st"> </span>torch<span class="op">$</span><span class="kw">max</span>(outputs<span class="op">$</span>data, 1L)</a>
<a class="sourceLine" id="cb26-40" data-line-number="40">                predicted &lt;-<span class="st"> </span>.predicted[1L]</a>
<a class="sourceLine" id="cb26-41" data-line-number="41">                <span class="co"># Total number of labels</span></a>
<a class="sourceLine" id="cb26-42" data-line-number="42">                total =<span class="st"> </span>total <span class="op">+</span><span class="st"> </span>labels<span class="op">$</span><span class="kw">size</span>(0L)</a>
<a class="sourceLine" id="cb26-43" data-line-number="43">                <span class="co"># Total correct predictions</span></a>
<a class="sourceLine" id="cb26-44" data-line-number="44">                correct =<span class="st"> </span>correct <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>((predicted<span class="op">$</span><span class="kw">numpy</span>() <span class="op">==</span><span class="st"> </span>labels<span class="op">$</span><span class="kw">numpy</span>()))</a>
<a class="sourceLine" id="cb26-45" data-line-number="45">            }</a>
<a class="sourceLine" id="cb26-46" data-line-number="46">            accuracy =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>correct <span class="op">/</span><span class="st"> </span>total</a>
<a class="sourceLine" id="cb26-47" data-line-number="47">            <span class="co"># Print Loss</span></a>
<a class="sourceLine" id="cb26-48" data-line-number="48">            <span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">'Iteration: %5d. Loss: %f. Accuracy: %8.2f </span><span class="ch">\n</span><span class="st">'</span>,</a>
<a class="sourceLine" id="cb26-49" data-line-number="49">                  iter, loss<span class="op">$</span><span class="kw">item</span>(), accuracy))</a>
<a class="sourceLine" id="cb26-50" data-line-number="50">        }</a>
<a class="sourceLine" id="cb26-51" data-line-number="51">    }</a>
<a class="sourceLine" id="cb26-52" data-line-number="52">}</a>
<a class="sourceLine" id="cb26-53" data-line-number="53"><span class="co">#&gt; Iteration:   500. Loss: 1.859928. Accuracy:    66.89 </span></a>
<a class="sourceLine" id="cb26-54" data-line-number="54"><span class="co">#&gt; Iteration:  1000. Loss: 1.588402. Accuracy:    75.31 </span></a>
<a class="sourceLine" id="cb26-55" data-line-number="55"><span class="co">#&gt; Iteration:  1500. Loss: 1.412573. Accuracy:    78.88 </span></a>
<a class="sourceLine" id="cb26-56" data-line-number="56"><span class="co">#&gt; Iteration:  2000. Loss: 1.168882. Accuracy:    80.57 </span></a>
<a class="sourceLine" id="cb26-57" data-line-number="57"><span class="co">#&gt; Iteration:  2500. Loss: 1.121223. Accuracy:    81.90 </span></a>
<a class="sourceLine" id="cb26-58" data-line-number="58"><span class="co">#&gt; Iteration:  3000. Loss: 1.019733. Accuracy:    82.81</span></a></code></pre></div>
<blockquote>
<p>This is a modified version of the original article.</p>
</blockquote>
<p>Source: <a href="https://www.deeplearningwizard.com/deep_learning/practical_pytorch/pytorch_logistic_regression/" class="uri">https://www.deeplearningwizard.com/deep_learning/practical_pytorch/pytorch_logistic_regression/</a></p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
